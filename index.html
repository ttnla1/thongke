<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>App tính toán</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
</head>
<body>

<button onclick="login()">Đăng nhập Google</button>
<button onclick="logout()">Đăng xuất</button>

<br><br>
<textarea id="data" placeholder="Nhập dữ liệu..."></textarea>
<br>
<button onclick="save()">Lưu</button>
<button onclick="load()">Xem đã lưu chưa</button>
<button onclick="clearData()">Xóa dữ liệu</button>

<script>
const supabase = supabaseJs.createClient(
  "SUPABASE_URL",
  "SUPABASE_ANON_KEY"
)

async function login() {
  await supabase.auth.signInWithOAuth({ provider: 'google' })
}

async function logout() {
  await supabase.auth.signOut()
}

async function save() {
  const user = (await supabase.auth.getUser()).data.user
  await supabase.from('records').insert({
    user_id: user.id,
    content: document.getElementById('data').value
  })
  alert("Đã lưu")
}

async function load() {
  const user = (await supabase.auth.getUser()).data.user
  const { data } = await supabase
    .from('records')
    .select('*')
    .eq('user_id', user.id)

  alert(data.length ? "Có dữ liệu đã lưu" : "Chưa có dữ liệu")
}

async function clearData() {
  const user = (await supabase.auth.getUser()).data.user
  await supabase.from('records').delete().eq('user_id', user.id)
  alert("Đã xóa")
}
</script>

</body>
</html>
